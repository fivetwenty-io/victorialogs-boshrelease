#!/bin/bash
set -e

# Extract port from http_listen_addr (format is [addr]:port or :port)
LISTEN_ADDR="<%= p('vlinsert.http_listen_addr') %>"
PORT=$(echo "$LISTEN_ADDR" | sed 's/.*://')

# Check if VLInsert is responding to health checks
if curl -sf "http://localhost:${PORT}/health" >/dev/null 2>&1; then
    exit 0
else
    echo "VLInsert health check failed"
    exit 1
fi
