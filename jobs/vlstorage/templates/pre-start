#!/bin/bash
set -e

# Include coordination helpers
READY_DIR=/var/vcap/sys/run/ready
mkdir -p $READY_DIR
chmod 777 $READY_DIR

clear_ready() {
    local service=$1
    rm -f $READY_DIR/$service
    echo "[$(date '+%H:%M:%S')] $service: Cleared ready status"
}

# Clear ready status at start
clear_ready "vlstorage"

export DOCKER_HOST=unix:///var/vcap/sys/run/docker/docker.sock

echo "VLStorage pre-start: preparing runtime environment..."

# Create VLStorage data directory
echo "Creating VLStorage data directory"
mkdir -p <%= p('vlstorage.storage_path') %>
chown -R vcap:vcap <%= p('vlstorage.storage_path') %>

echo "VLStorage pre-start configuration complete"
