#!/bin/bash
set -e

# Extract VictoriaLogs binaries
tar -xzf victoria-logs/victoria-logs-linux-amd64-v1.36.1.tar.gz

# Create bin directory
mkdir -p ${BOSH_INSTALL_TARGET}/bin

# Check what binaries are actually in the archive
echo "Contents of the archive:"
ls -la

# Install the victoria-logs-prod binary
# This single binary runs in different modes based on command-line flags
if [ -f "victoria-logs-prod" ]; then
  cp victoria-logs-prod ${BOSH_INSTALL_TARGET}/bin/victoria-logs-prod
  echo "Installed victoria-logs-prod binary"
else
  echo "ERROR: victoria-logs-prod binary not found"
  exit 1
fi

# Make binary executable
chmod +x ${BOSH_INSTALL_TARGET}/bin/*

# List installed binaries
echo "Installed binaries:"
ls -la ${BOSH_INSTALL_TARGET}/bin/